function rcm(e){var getname=/^(\w[\w_ ]+[\w_])(?![\w_])/,linktest=/(?:showplayer|displaycollection)\.php\?who=(\d+)/;if(!e)var e=window.event;var playername,playerid,posx,posy,docX,docY,menuW,menuH,t=e.target?e.target:e.srcElement,contextmenu=menu?menu:document.getElementById("menu");if(posx=posy=0,0==actions.length)return!0;if(!t||!t.firstChild||!t.firstChild.nodeValue)return!0;for(var innards=t.firstChild.nodeValue;1!=t.nodeType;)t=t.parentNode;for(;"A"!=t.nodeName&&"HTML"!=t.nodeName;)t=t.parentNode;if("HTML"==t.nodeName)return!0;if(!linktest.test(t.href))return!0;if(playerid=RegExp.$1,1>playerid)return!0;if(getname.test(innards),playername=RegExp.$1,"Mod Warning"==playername||"System Message"==playername||"Mod Announcement"==playername)return!0;with(e.cancelBubble=!0,e.stopPropogation&&e.stopPropogation(),self.innerHeight?(docX=innerWidth,docY=innerHeight):document.documentElement&&document.documentElement.clientHeight?(docX=document.documentElement.clientWidth,docY=document.documentElement.clientHeight):document.body&&(docX=document.body.clientWidth,docY=document.body.clientHeight),self.pageYOffset?(scrollX=pageXOffset,scrollY=pageYOffset):document.documentElement&&document.documentElement.scrollTop?(scrollX=document.documentElement.scrollLeft,scrollY=document.documentElement.scrollTop):document.body&&(scrollX=document.body.scrollLeft,scrollY=document.body.scrollTop),e.pageX||e.pageY?(posx=e.pageX,posy=e.pageY):(e.clientX||e.clientY)&&(posx=e.clientX+document.body.scrollLeft,posy=e.clientY+document.body.scrollTop),contextmenu){style.top="-10000px",style.left="0px",style.display="block",innerHTML="";for(var entry in actions){var action=actions[entry];1==action.action?innerHTML+='<p class="rcm" onclick="u(\''+entry+"?"+action.arg+"="+playerid+"');\"> "+action.title+" </p>":5==action.action?innerHTML+='<p class="rcm" onclick="launch(\''+entry+"', '"+playerid+"', '"+playername+"');\"> "+action.title+" </p>":notchat||(innerHTML+='<p class="rcm" onclick="launch(\''+entry+"', '"+playerid+"', '"+playername+"');\"> "+entry+" </p>")}menuH=offsetHeight,menuW=offsetWidth,style.top=posy+"px",style.left=posx+"px",posx+menuW>docX&&(posx-=menuW),posy+menuH>docY&&(posy-=menuH),style.top=posy+"px",style.left=posx+"px"}return!1}function disappear(e){if(0==actions.length)return!0;if(!e)var e=window.event;for(var t=e.target?e.target:e.srcElement;1!=t.nodeType;)t=t.parentNode;for(;"DIV"!=t.nodeName&&"HTML"!=t.nodeName;)t=t.parentNode;return"DIV"==t.nodeName&&"menu"==t.id?!0:void force()}function force(){if(0==actions.length)return!0;var e=menu?menu:document.getElementById("menu");e.style.display="none",e.style.top="0px",e.style.left="0px"}function u(e){var t=window.opener?window.opener.top.mainpane:top.mainpane;t.location.href=base+"/"+e,force(),t.focus&&t.focus()}function launch(e,t,n){var o=actions[e];if(o){var c=o.query;switch(c&&(c=c.replace(/%/,n)),force(),o.action<5&&this.top&&top.chatpane&&top.chatpane.cycles&&(top.chatpane.cycles=0),o.action){case 2:o.submit?submitchat(e+" "+(o.useid?t:n)):(document.chatform.graf.value=e+" "+(o.useid?t:n),document.chatform.graf.focus&&document.chatform.graf.focus());break;case 3:var a=prompt(c);a&&submitchat(e+" "+(o.useid?t:n)+" "+a);break;case 4:confirm(c)&&submitchat(e+" "+(o.useid?t:n));break;case 5:var r=window.open(e+t,"playerviewer","scrollbars=yes,resizable=yes,height=780,width=900");r.focus&&r.focus()}}}function rearm(e){actions=e}var base=location.protocol+"//"+location.host,menu;document.getElementById&&document.createElement&&(menu=document.getElementById("menu"),document.oncontextmenu=rcm,document.onclick=disappear,document.onkeyup=disappear);
